apiVersion: 1

groups:
  - orgId: 1
    name: SystemAlerts
    folder: Alerts
    interval: 1m
    rules:

      # SECTION 1: STANDARD REACTIVE ALERTS (Real-time)

      # 1. High CPU Usage
      - uid: cpu_usage_high
        title: High CPU Usage
        condition: C
        data:
          - refId: A
            relativeTimeRange: { from: 300, to: 0 }
            datasourceUid: Prometheus
            model:
              expr: 100 - (avg(rate(windows_cpu_time_total{job="windows-pc", mode="idle"}[5m])) * 100)
              format: time_series
              refId: A
          - refId: B
            datasourceUid: __expr__
            model:
              type: reduce
              expression: A
              reducer: last
              refId: B
          - refId: C
            datasourceUid: __expr__
            model:
              type: threshold
              expression: B
              conditions: [{ evaluator: { type: gt, params: [80] }, type: query }]
              refId: C
        noDataState: NoData
        execErrState: Error
        for: 2m
        annotations:
          summary: "CPU usage is above 80%"
          description: "Instance has high CPU usage for more than 2 minutes."

      # 2. High Memory Usage
      - uid: memory_usage_high
        title: High Memory Usage
        condition: C
        data:
          - refId: A
            relativeTimeRange: { from: 300, to: 0 }
            datasourceUid: Prometheus
            model:
              expr: 100 * (1 - (windows_memory_available_bytes{job="windows-pc"} / windows_memory_physical_total_bytes{job="windows-pc"}))
              format: time_series
              refId: A
          - refId: B
            datasourceUid: __expr__
            model:
              type: reduce
              expression: A
              reducer: last
              refId: B
          - refId: C
            datasourceUid: __expr__
            model:
              type: threshold
              expression: B
              conditions: [{ evaluator: { type: gt, params: [95] }, type: query }]
              refId: C
        noDataState: NoData
        execErrState: Error
        for: 2m
        annotations:
          summary: "Memory usage above 95%"
          description: "System physical memory usage has exceeded 95%."

      # 3. High Disk Usage
      - uid: disk_usage_high
        title: High Disk Usage
        condition: C
        data:
          - refId: A
            relativeTimeRange: { from: 300, to: 0 }
            datasourceUid: Prometheus
            model:
              expr: 100 - (avg(windows_logical_disk_free_bytes{job="windows-pc", volume="C:"}) / avg(windows_logical_disk_size_bytes{job="windows-pc", volume="C:"})) * 100
              format: time_series
              refId: A
          - refId: B
            datasourceUid: __expr__
            model:
              type: reduce
              expression: A
              reducer: last
              refId: B
          - refId: C
            datasourceUid: __expr__
            model:
              type: threshold
              expression: B
              conditions: [{ evaluator: { type: gt, params: [90] }, type: query }]
              refId: C
        noDataState: NoData
        execErrState: Error
        for: 2m
        annotations:
          summary: "Disk usage above 90%"
          description: "Drive C: has less than 10% free space remaining."

      # 4. High Network Utilization
      - uid: network_usage_high
        title: High Network Utilization
        condition: C
        data:
          - refId: A
            relativeTimeRange: { from: 300, to: 0 }
            datasourceUid: Prometheus
            model:
              expr: avg(rate(windows_net_bytes_total{job="windows-pc"}[5m])) / 1000000
              format: time_series
              refId: A
          - refId: B
            datasourceUid: __expr__
            model:
              type: reduce
              expression: A
              reducer: last
              refId: B
          - refId: C
            datasourceUid: __expr__
            model:
              type: threshold
              expression: B
              conditions: [{ evaluator: { type: gt, params: [100] }, type: query }]
              refId: C
        noDataState: NoData
        execErrState: Error
        for: 2m
        annotations:
          summary: "High Network Traffic"
          description: "Average network throughput has exceeded 100 MB/s."

      # 5. High System Load
      - uid: system_load_high
        title: High System Load
        condition: C
        data:
          - refId: A
            relativeTimeRange: { from: 300, to: 0 }
            datasourceUid: Prometheus
            model:
              expr: avg(windows_system_processor_queue_length{job="windows-pc"})
              format: time_series
              refId: A
          - refId: B
            datasourceUid: __expr__
            model:
              type: reduce
              expression: A
              reducer: last
              refId: B
          - refId: C
            datasourceUid: __expr__
            model:
              type: threshold
              expression: B
              conditions: [{ evaluator: { type: gt, params: [15] }, type: query }]
              refId: C
        noDataState: NoData
        execErrState: Error
        for: 2m
        annotations:
          summary: "High System Load"

      
      # SECTION 2: AI PREDICTIVE ALERTS (Forecasts)
      

      # 6. PREDICTION: Disk Full Soon
      - uid: pred_disk
        title: "AI Prediction: Disk Full Soon"
        condition: C
        data:
          - refId: A
            relativeTimeRange: { from: 600, to: 0 }
            datasourceUid: Prometheus
            model:
              expr: disk_percentage_predicted_in_15_min
              format: time_series
              refId: A
          - refId: B
            datasourceUid: __expr__
            model:
              type: reduce
              expression: A
              reducer: last
              refId: B
          - refId: C
            datasourceUid: __expr__
            model:
              type: threshold
              expression: B
              conditions: [{ evaluator: { type: gt, params: [95] }, type: query }]
              refId: C
        noDataState: NoData
        execErrState: Error
        for: 1m
        annotations:
          summary: "AI Forecast: Disk will be full in 15m"
          description: "The AI model predicts disk usage will reach {{ $values.B.Value | printf '%.2f' }}% shortly."

      # 7. PREDICTION: CPU Saturation 
      - uid: pred_cpu
        title: "AI Prediction: High CPU Load Incoming"
        condition: C
        data:
          - refId: A
            relativeTimeRange: { from: 600, to: 0 }
            datasourceUid: Prometheus
            model:
              expr: cpu_usage_predicted_in_15_min
              format: time_series
              refId: A
          - refId: B
            datasourceUid: __expr__
            model:
              type: reduce
              expression: A
              reducer: last
              refId: B
          - refId: C
            datasourceUid: __expr__
            model:
              type: threshold
              expression: B
              conditions: [{ evaluator: { type: gt, params: [90] }, type: query }]
              refId: C
        noDataState: NoData
        execErrState: Error
        for: 1m
        annotations:
          summary: "AI Forecast: CPU will saturate soon"
          description: "Model predicts CPU will hit {{ $values.B.Value | printf '%.2f' }}% in 15 mins."

      # 8. PREDICTION: Memory Saturation 
      - uid: pred_mem
        title: "AI Prediction: Memory Saturation Soon"
        condition: C
        data:
          - refId: A
            relativeTimeRange: { from: 600, to: 0 }
            datasourceUid: Prometheus
            model:
              expr: memory_usage_predicted_in_15_min
              format: time_series
              refId: A
          - refId: B
            datasourceUid: __expr__
            model:
              type: reduce
              expression: A
              reducer: last
              refId: B
          - refId: C
            datasourceUid: __expr__
            model:
              type: threshold
              expression: B
              conditions: [{ evaluator: { type: gt, params: [95] }, type: query }]
              refId: C
        noDataState: NoData
        execErrState: Error
        for: 1m
        annotations:
          summary: "AI Forecast: Memory will saturate soon"
          description: "Model predicts RAM usage will hit {{ $values.B.Value | printf '%.2f' }}% in 15 mins."

      # 9. PREDICTION: Network Spike 
      - uid: pred_net
        title: "AI Prediction: Network Traffic Spike"
        condition: C
        data:
          - refId: A
            relativeTimeRange: { from: 600, to: 0 }
            datasourceUid: Prometheus
            model:
              expr: network_usage_predicted_in_15_min
              format: time_series
              refId: A
          - refId: B
            datasourceUid: __expr__
            model:
              type: reduce
              expression: A
              reducer: last
              refId: B
          - refId: C
            datasourceUid: __expr__
            model:
              type: threshold
              expression: B
              # Alert if predicted traffic > 100 MB/s
              conditions: [{ evaluator: { type: gt, params: [100] }, type: query }]
              refId: C
        noDataState: NoData
        execErrState: Error
        for: 1m
        annotations:
          summary: "AI Forecast: High Network Load"
          description: "Model predicts network traffic will exceed 100MB/s."